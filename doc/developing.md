## Development

*Please Note*: There is little to no documentation at this time and any
comments in the code may be out of date.

### Minification of CSS and JavaScript files

The build script needs to know which files to minify and the correct order used
to concatenate. Anytime a CSS or JavaScript file is added. renamed, or removed,
the following files must be updated:

* ``etc/deploy/wv.css.json``
* ``etc/deploy/wv.js.json``

To ensure that references to the unminified value are removed in the production
version, prefix all CSS or JavaScript link tags with

    <!-- link.dev -->

If there are some CSS or JavaScript files that must be available in
non-concatenated form, add exceptions in the ``remove:source`` task in
``Gruntfile.js``

## Syncing with remote branch
Update packages that may have been adjusted since your last pull

     grunt update-packages

## Naming and Versioning

The ``options.json`` file contains the name, version, and release number
that is used when building the deployment packages. The name can be changed
to allow side-by-side deployments of different branches. Executing:

     grunt

also creates distribution tarballs in the dist directory. Three "unversioned"
files are generated:

* ``dist/worldview.tar.bz2``
* ``dist/worldview-debug.tar.bz2``
* ``dist/worldview-doc.tar.bz2``

Three "versioned" files are also generated in the form of:

* ``dist/<name>-<version>-<release>.git<revision>.tar.bz2``

Where ``name``, ``version``, ``release`` are the values found in the
``package.json`` file and ``revision`` is the value from:

    git rev-parse --short HEAD

The ``options.json`` file in the repository root is copied from the
active brand directory. To make changes, edit the official copy in the
brand directory.


## NPM / Grunt Task Targets

These additional task targets are available.   

**NOTE:** Grunt tasks are being depreciated in favor of NPM tasks. For each `grunt` task there is an equivalent `npm run` task.

### Sync runtime node modules

Any new update to runtime npm modules, by such means as 'npm install', 'npm update', or a version change in package.json will need to be synced to the web directory:

```
npm run update
```
or grunt command (depreciated)
```
grunt update
```

### Branding

Any changes to the brading directories need to be applied to the source
tree to take effect:

```
npm run brand
```
or grunt command (depreciated)
```
grunt brand
```

### Edit Libraries and sync changes on save

Make edits to node_modules that are [npm linked](https://docs.npmjs.com/cli/link) and have them relocate to the web directory automatically.

```
npm run watch
```
or grunt command (depreciated)
```
grunt watch
```

### Configuration

The Worldivew configuration file is generated by concatenating all files
in ``conf/web``

To regenerate the master configuration file in the source tree after making an edit, issue the following npm command:

````
npm run config
```
or grunt command (depreciated)
```
grunt config
```

### Autoprefix CSS

Parse all CSS files and automatically add vendor prefixes to CSS rules using values from Can I Use.

Run autoprefix with the following:

```
npm run autoprefix
```
or grunt command (depreciated)
```
grunt autoprefix
```

### Linting

Check for common errors in the JavaScript and CSS files with the following npm command:

```
npm run lint
```
or grunt command (depreciated)
```
grunt lint
```

[eslint](http://eslint.org) is used for JavaScript linting.
Run the following npm command to check only Javascript errors:

```
npm run eslint
```
or grunt command (depreciated)
```
grunt eslint
```

[stylelint](https://stylelint.io) is used for CSS linting.
Run the following npm command to check only CSS errors:

```
npm run stylelint
```
or grunt command (depreciated)
```
grunt stylelint
```

Run the following to automatically fix stylelint errors:

```
npm run stylefmt
```
or grunt command (depreciated)
```
grunt stylefmt
```

### Unit Tests

Run unit test with the following npm command:

```
npm run test
```
or grunt command (depreciated)
```
grunt test
```

This uses BusterJS with PhantomJS for headless browser testing. To test in an
actual browser which is quicker, install the Buster command line tools
with:

    sudo npm install --global buster-cli

For static testing like QUnit, run the following and navigate the web browser
to the address shown:

    buster-static

For browser capturing, run the following and navigate the web browser to
the address shown:

    buster-server


### RPM

To create an RPM on CentOS 6, issue the following npm command:

```
npm run rpm-only
```
or grunt command (depreciated)
```
grunt rpm-only
```

Built RPMs will be found in the ``dist`` directory.
