matrix:
  include:
  - os: linux
    dist: trusty
    language: node_js
    node_js: '8.15.1'
    before_install:
      - sudo apt-get update
      - sudo apt-get install -y libgif-dev
  - os: linux
    dist: trusty
    language: node_js
    node_js: lts/* # latest LTS Node.js release
    before_install:
      - sudo apt-get update
      - sudo apt-get install -y libgif-dev
  - os: osx
    language: node_js
    node_js: '8.15.1'
    before_install:
      - HOMEBREW_NO_AUTO_UPDATE=1 brew install pkg-config cairo libffi
    before_cache:
      - brew cleanup
    cache:
      directories:
        - $HOME/Library/Caches/Homebrew
  - os: osx
    language: node_js
    node_js: lts/* # latest LTS Node.js release
    before_install:
      - HOMEBREW_NO_AUTO_UPDATE=1 brew install pkg-config cairo libffi
    before_cache:
      - brew cleanup
    cache:
      directories:
        - $HOME/Library/Caches/Homebrew
  - os: windows
    language: node_js
    python: '2.7.16'
    node_js: '8.15.1'
    before_install:
      - GTKDIR="c:/GTK"
      - GTKFILE="$HOME/GTK_TEMP/gtk.zip"
      - PYDIR="c:/Python27"
      - if [ ! -d "$PYDIR" ] || [ ! "$(ls -A $PYDIR)" ]; then choco install python2; fi
      - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
      - python -m ensurepip
      - pip install virtualenv
      - virtualenv $HOME/venv
      - source $HOME/venv/Scripts/activate
      - if [ ! -f "$GTKFILE" ]; then curl -o $GTKFILE "http://ftp.gnome.org/pub/GNOME/binaries/win64/gtk+/2.22/gtk+-bundle_2.22.1-20101229_win64.zip" -O -J -L; fi
      - if [ ! -d "$GTKDIR" ]; then mkdir $GTKDIR; fi
      - if [ ! "$(ls -A $GTKDIR)" ]; then unzip $GTKFILE -d $GTKDIR; fi
    cache:
      directories:
        - c:/GTK
        - $HOME/GTK_TEMP
        - $HOME/venv
        - $HOME/.node-gyp
        - c:/Python27
        - c:/Python27/Scripts
  - os: windows
    language: node_js
    python: '2.7.16'
    node_js: lts/* # latest LTS Node.js release
    before_install:
      - GTKDIR="c:/GTK"
      - GTKFILE="$HOME/GTK_TEMP/gtk.zip"
      - PYDIR="c:/Python27"
      - if [ ! -d "$PYDIR" ] || [ ! "$(ls -A $PYDIR)" ]; then choco install python2; fi
      - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
      - python -m ensurepip
      - pip install virtualenv
      - virtualenv $HOME/venv
      - source $HOME/venv/Scripts/activate
      - if [ ! -f "$GTKFILE" ]; then curl -o $GTKFILE "http://ftp.gnome.org/pub/GNOME/binaries/win64/gtk+/2.22/gtk+-bundle_2.22.1-20101229_win64.zip" -O -J -L; fi
      - if [ ! -d "$GTKDIR" ]; then mkdir $GTKDIR; fi
      - if [ ! "$(ls -A $GTKDIR)" ]; then unzip $GTKFILE -d $GTKDIR; fi
    cache:
      directories:
        - c:/GTK
        - $HOME/GTK_TEMP
        - $HOME/venv
        - $HOME/.node-gyp
        - c:/Python27
        - c:/Python27/Scripts

cache:
  directories:
    - node_modules
    - .python
  npm: true
  pip: true

install: npm install

script: npm test
